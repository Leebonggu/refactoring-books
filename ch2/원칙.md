# 2. 리팩터링 원칙

## 2.1 리팩터링의 정의

리팩터링이라는 말은 자주 사용되지만, 사용하는 사람마다 정의가 다르다. 리팩터링은 명사로도, 동사로도 사용가능하다.

> 명사: 소프트웨어의 겉보기 동작은 그대로 유지한 채 코드를 이해하기 수정하기 쉽도록 내부 구조를 변경하는 방법

1장에서 살펴본, 함수추출하기와 조건부 로직을 다형성으로 바꾸기처럼 이름 붙은 리팩터링 기법들이 명사 정의에 해당

> 동사: 소프트웨어의 겉보기 동작은 그대로 유지한 채, 여러 가지 리팩터링 기법을 적용해서 소프트웨어를 재구성한다.

대부분의 사람들이 리팩터링 용어를 사용하지만, 대부분은 코드를 고치면 리팩터링이라고 말을 한다. 하지만 정의에 따르면 `특정한 방식에 따라 코드를 정리하는 것`만이 리팩터링이다. 동작을 보존하는 작은 단계들을 거쳐 코드를 수정하고, 이러한 단계들을 순차적으로 연결하여 큰 변화를 만들어내는 일이다.

겉보기 동작을 그대로 유지한다는 것은 리팩터링 전과 후의 코드가 똑같이 작동해야 한다는 뜻이다. 코드에 변경이 있지만, 사용자 입장에서는 이전과 똑같은 경험을 할 수 있어야 한다는 것이다. 리팩터링은 성능 최적화와 비슷한 과정이다. 둘다 코드를 변경하지만 전반적인 기능을 유지한다. 단지 목적이 다른데 `리팩터링`은 코드를 이해하고 수정하기 쉽게 만드는 것이 목적이다. `성능최적화`는 속도 개선이 목적이다.

## 2.2 두개의 모자

내가 현재 하는 작업이 어떤 작업인지 구분하는게 중요하다. 예를들어 소프트웨어를 개발할 때 목적이 '기능추가'인지, '리팩터링'인지 구분해서 작업하는걸 생각해보자. `기능을 추가`할 때는 기존의 코드는 건드리지 않고, 기능추가에만 집중을 한다. 작업정도는 테스트를 추가해서 통과하는지 확인하는 방식으로 한다. 반면 `리팩터링`을 할 때는 기능 추가는 절대 하지않고, 오로지 코드 재구성에만 집중한다.

새 기능을 추가하다보면 구조를 바꿔야 작업하기 훨씬 쉽겠다는 생각이 드는데, 그럼 잠시 멈추고 리팩터링을 진행한다. 코드 구조가 어느정도 개선되면 기능추가에 집중한다. 추가한 기능이 제대로 작동하는지 확인하면 작성한 코드를 살펴보고, 코드가 이해하기 어렵다면 리팩터링을 진행한다. 

> 리팩터링을 평소에 한다면, 몰아서 할 때보다 수고가 줄어들 수 있겠다. 현재 내가 하는 작업이 기능추가인지, 리팩터링인지 알고 작업한다면 작업 능률이 더 올라갈 수 있겠다. 왜냐면, 기능추가하다보면 기존 코드를 보면서 수정하고싶은 마음이 생기고, 그 코드를 고치다 결국 기존목적인 기능추가보다 코드를 수정하는데 더 시간을 쓰는 경우가 생기기도 한다. 이런 상황은 결국 전체 프로젝트의 작업 속도를 늦출수도 있겠다 싶음.

## 2.3 리팩터링하는 이유

리팩터링이 코드를 건강한 상태로 유지하는데 도와준다. 

### 2.3.1 리팩터링하면 소프트웨어 설계가 좋아진다.

리팩터링하지 않으면 소프트웨어의 내부 설계(아키텍쳐)가 섞기 쉽다. 아키텍처를 충분히 이해하지 못한 채 단기 목표만을 위해 코드를 수정하다보면 기반 구조가 무너진다. 그 결과 코드만 봐서는 설계를 파악하기 어려워진다.

### 2.3.2 리팩터링하면 소프트웨어를 이해하기 쉬워진다

프로그래밍은 내가 원하는 바를 정확히 표현하는 일이다. 문제는 프로그램을 동작시키는데만 신경 쓰다보면 나중에 그 코드를 다룰 개발자를 배려하지 못한다는 것에 있다. 코드를 이해하기 쉽게 만들려면 리팩터링이 필요하다. 리팩터링을 통해 코드의 목적이 더 잘 드러나게, 내 의도를 더 명확하게 전달하도록 개선할 수 있다. 잘 리팩터링된 코드는 나중에 봤을 때 이해하기 쉽기 때문에 코드를 이해할 필요성을 크게 줄일 수 있다.

### 2.3.3 리팩터링하면 버그를 쉽게 찾을 수 있다.

코드를 이해하기 쉽다는 말은 버그를 찾기 쉽다는 말이기도 하다. 리팩터링하면 코드가 하는 일을 깊이 파악하게 되면서 새로 깨달은 것을 곧바로 코드에 반영하게 된다. 프로그램의 구조를 명확하게 다듬으면 코드가 명확해지기 때문에 버그를 발견하거나, 비효율적인 구조를 파악하기 쉬워진다. `리팩터링을 습관화 하자.`

### 2.3.4 리팩터링하면 프로그래밍 속도를 높일 수 있다.

리팩터링하는 데 시간이 드니 전체 개발속도가 떨어질것 같지만, 리팩터링하면 코드 개발 속도를 높일 수 있다. 리팩터링 없이 진행되는 개발은 초기에는 속도가 빠를 수 있다. 하지만 개발이 진행될 수록 새로운 기능을 추가하기 위해 기존 코드베이스를 분석하는데 시간이 더 소요된다. 그 이유는 소프트웨어 내부 품질에 있는데, 내부 설계가 잘 된 소프트웨어는 새로운 기능을 추가할 지점과 어떻게 고칠지를 쉽게 찾을 수 있다.

모듈화가 잘 되어있으면 전체 코드베이스 중 작은 일부만 이해하면 된다. 코드가 명확하면 버그를 만들 가능성도 줄고 버그를 만들더라도 디버깅하기 쉽다. 내부 품질이 뛰어난 코드베이스는 새 기능 구축을 돕는 견고한 토대가 된다. 내부 설계에 심혀을 기울이면 소프트웨어 지구력이 높아져서 바르게 개발할 수 있는 상태를 더 오래 지속 가능하다`(설계 지구력 가설)`.

코딩 단계에 한번 들어서면 코드가 부패할 일만 남는다. 때문에 코딩 시작하기 전에 설계부터 완벽히 마쳐야 한다는 것이 정설이었다. 리팩터링을 하면 코딩 단계에서 발생하는 코드 부패를 최소화 할 수 있다. 기존 코드 설계를 얼마든지 개선할 수 있다

## 2.4 언제 리팩터링 해야할까

필자는 한시간 간격으로 리팩터링한다고 하는데 -> `너무 병적라고 생각함`
### 2.4.1 3의 법칙(3스트라이크 리팩터링)

돈 로버츠가 제시한 가이드

1. 처음에는 그냥 한다.
2. 비슷한 일을 두번째 하게 되면(중복이 생겼다는 사실에 당황스럽겠지만), 일단 계속 진행한다.
3. 비슷한 일을 세 번째 하게되면 리팩터링한다

### 2.4.2 준비를 위한 리팩터링: 기능을 쉽게 추가하게 만들기

리팩터링하기 가장 좋은 시점은 코드베이스에 기능을 새로 추가하기 직전이다. 기능을 추가하는 시점에 구조를 삭짝 바꾸면 다른 작업을 하기가 훨씬 쉬워질 만한 부분을 찾는다.

### 2.4.3 이해를 위한 리팩터링: 코드를 이해하기 쉽게 만들기
### 2.4.4 쓰레기 줍기 리팩터링
### 2.4.5 계획된 리팩터링과 수시로 하는 리팩터링
### 2.4.6 오래 걸리는 리팩터링
### 2.4.7 코드 리뷰에 리팩터링 활용하기
### 2.4.8 관리자에게는 뭐라고 말해야 할까
### 2.4.9 리팩터링 하지 말아야 할 때



